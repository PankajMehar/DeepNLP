ANonparametricDelayedFeedbackModelforConversionRatePredictionYuyaYoshikawa1,YusakuImai21STAIRLab,ChibaInstituteofTechnology2CyberAgent,Inc.yoshikawa@stair.center,y24twentyfour@gmail.comAbstractPredictingconversionrates(CVRs)indisplayad-vertising(e.g.,predictingtheproportionofuserswhopurchaseanitem(i.e.,aconversion)afteritscorrespondingadisclicked)isimportantwhenmeasuringtheeffectsofadsshowntousersandtounderstandingtheinterestsoftheusers.Thereisgenerallyatimedelay(i.e.,so-calleddelayedfeed-back)betweentheadclickandconversion.Owingtothedelayedfeedback,samplesthatareconvertedafteranobservationperiodmaybetreatedasneg-ative.Toovercomethisdrawback,CVRpredictionassumingthatthetimedelayfollowsanexponentialdistributionhasbeenproposed.Inpractice,how-ever,thereisnoguaranteethatthedelayisgener-atedfromtheexponentialdistribution,andthebestdistributionwithwhichtorepresentthedelayde-pendsonthedata.Inthispaper,weproposeanon-parametricdelayedfeedbackmodelforCVRpre-dictionthatrepresentsthedistributionofthetimedelaywithoutassumingaparametricdistribution,suchasanexponentialorWeibulldistribution.Be-causethedistributionofthetimedelayismodeleddependingonthecontentofanadandthefeaturesofauser,variousshapesofthedistributioncanberepresentedpotentially.Inexperiments,weshowthattheproposedmodelcancapturethedistribu-tionforthetimedelayonasyntheticdataset,evenwhenthedistributioniscomplicated.Moreover,onarealdataset,weshowthattheproposedmodeloutperformstheexistingmethodthatassumesanexponentialdistributionforthetimedelayintermsofconversionrateprediction.1IntroductionPredictingconversionrates(CVRs)indisplayadvertising(e.g.,theproportionofuserswhopurchaseanitem(i.e.,conversion)afteritscorrespondingadisclicked)isimpor-tantwhenmeasuringtheeffectsofadvertisementsshowntousersandtounderstandingtheinterestsoftheusers.There-fore,themodelsforCVRpredictionhasbeenwell-studiedforseveralyears[Leeetal.,2012;Rosalesetal.,2012;Jietal.,2017].IDClickdateConversion dateAd feature1…Userfeature 1…12018/01/0410:12:152018/01/1216:30:020.1…10.3…22018/01/0508:42:33unobserved0.3…8.4……………………n2018/03/3022:50:11unobserved0.8…12.2…Figure1:Anexampleofaconversionlogdatabase.Eachrow(sam-ple)includestheclickdate,conversiondate,adfeaturesanduserfeatures.Ifthesamplehasnotyetbeenconverted,itsconversiondateisrecordedas‘unobserved’.ConversionlogsarestoredinadatabaselikethatshowninFigure1.Betweentheadclickandconversion,atimedelay(i.e.,theso-calleddelayedfeedback)basicallyoccurs.Asaresult,theconversiondatesofthesamplesthathavenotbeenconvertedbytheendoftheobservationperiodarerecordedas‘unobserved’inthedatabase.BecausethetimedelayoftheCVRisfromhourstodays,theratioofsuchsamplesinthedatabaseisrelativelylarge[Chappelleetal.,2014].Suchsamplescannaivelybetreatedasnegativesampleswhenatrainingconversionmodelisbasedonlogisticre-gressionorasupportvectormachine.However,ifsomeofthesesamplesareeventuallyconverted,themodelislearnedonsampleswithincorrectlabels,resultinginpoorCVRpre-diction.ItisthusnecessaryinpracticetoconstructCVRpre-dictionmodelsconsideringthedelayedfeedback.Todealwiththisdrawback,ChapelleproposedaCVRpredictionmodelthatconsidersdelayedfeedback[Chapelle,2014].Here,thetimedelaysoftheconversionfollowanex-ponentialdistribution.AsshowninFigure5in[Chapelle,2014],however,theactualdistributionoftimedelaysisoftennon-exponentialandperiodic,andtheshapeofthedistribu-tionvariesbythesample.Thus,forthedistributionoftimedelaysforconversion,itismoredesirablenottoassumeanyshapeofthedistribution,suchasanexponentialorWeibulldistribution,andbeabletochangethedistributiontoﬁtthesample.Inthispaper,weproposeanonparametricdelayedfeedbackmodel(NoDeFforshort)forCVRpredictionthatrepresentsthedistributionofthetimedelaywithoutassuminganyparametricdistributions.NoDeFpartiallyborrowstheideasofkerneldensityestimation(KDE).Morespeciﬁcally,thedistributionforthetimedelayisdeﬁnedaccordingtotheweightedsumofkernelvaluesoftheconversiontimeandpseudo-pointsonthetimeaxis,wheretheweightsarelearnedfromdata.Then,aswith[Chapelle,2014],NoDeFassumesthateachsamplehasahiddenvariableindicatingwhetheritwillbeconvertedeventually.Inparameterestimation,whileestimatingtheassignmentofthehiddenvariable,theCVRpredictionmodelislearnedbytheEMalgorithm[Dempsteretal.,1977].NoDeFisageneralframeworkthatcanbeusedfornotonlyCVRpredictionindisplayadvertisementbutalsovariouscircumstancesinwhichdelayedfeedbackoccurs.Inexperiments,wedemonstratetheeffectivenessoftheproposedmodelonsyntheticandrealdatasets.Onthesyn-theticdataset,weshowthatNoDeFcanestimatetheshapeofthedistributionofthetimedelayfromdata.Ontherealdataset,weshowthatNoDeFcanpredicttheCVRfortestsamples,comparingwithexistingmethods.2RelatedWorkAsdescribedinSection1,NoDeFextendsthedelayedfeed-backmodelproposedby[Chapelle,2014].Theirmodelas-sumesthatthedistributionofatimedelayfollowsanexpo-nentialdistributionwithparametersdeterminedbytheinputsample.[Jietal.,2017]laterproposedamodelforwhichthedistributionisamixtureofWeibulldistributions,and[Sa-farietal.,2017]proposedanefﬁcientsolutionforthedelayedfeedbackmodelwithaWeibulldistribution.Tothebestofourknowledge,thepresentstudyistheﬁrsttorepresentthedis-tributionofdelayedfeedbacknonparametricallyintheCVRpredictionmodel.NoDeFwasinspiredbyanideaof[Duetal.,2012]torepresenttimedelaysofinformationdiffusiononsocialnet-worksbynonparametricdistributions.BecausethepresentstudydealswiththeproblemofCVRprediction,themathe-maticalformulationsofthepreviousandpresentpapersareessentiallydifferent.Moreover,weextendtheformulationofthedistributionofthetimedelaytobeabletopredictthedistributionforunseensamples.Anothertopicwellstudiedrecentlyindisplayadvertisingisthemulti-touchattributionsetting,whichconsidersthatusersareaffectedbytheadvertisementofanitemviapossiblymultipleadvertisingchannels,suchasdisplay,socialandpaidsearchadvertising.Modelsthatcorrectlymeasuretheeffectofanadineachchannelwhileconsideringthetimedelaybe-tweenclickandconversionhavebeenproposed[Zhangetal.,2015;Jietal.,2016;JiandWang,2017].Here,thedistribu-tionofthetimedelayinmulti-touchattributionalsofollowsanexponentialorWeibulldistribution.TheideaofNoDeFwouldthusbeusefulformodelingmulti-touchattribution.3Preliminary:SurvivalAnalysisThissectionbrieﬂyintroducesthetheoryofsurvivalanalysisrequiredtoexplainNoDeF.Survivalanalysiswasoriginallyconductedtoanalyzethetimeuntiloneormoreeventshappen,suchasthedeathofabiologicalorganismorthefailureofamechanicalsys-tem[KleinbaumandKlein,2012].Inrecentyears,survivalTable1:NotationsVariableDescriptionxi∈RMAfeaturevectorfortheithsamplerepresentingitsadanduser,whereMisthelengthofthefeaturevector.yi∈{0,1}Anobservedbinaryvalueofwhethertheithsampleisconverted.di∈[0,∞]Thedelaytimebetweentheclickandtheconversionfortheithsample.Ifnotconverted,di=∞.ei∈[0,∞)Theelapsedtimesincetheclickfortheithsample.ci∈{0,1}Ahiddenbinaryvalueofwhethertheithsamplewillbeconvertedeventu-ally.V∈RL×MAparametermatrixforthetimede-laymodel,Listhenumberofpseudo-pointsplacedontimeaxis.w∈RMAparametervectorfortheconversionmodel.analysishasalsobeenconductedtomodelusers’opinionfor-mation[Yuetal.,2017]andinformationpropagationphe-nomenaonsocialnetworks[Rodriguezetal.,2013]intheareaofdatamining.GivenarandomvariableT>0correspondingtothetimethataneventhappens,f(t)isdeﬁnedastheprobabilityden-sityofTandF(t)=Rt0f(x)dxisitscumulativedistributionfunction.Theprobabilitythataneventdoesnothappenuptotimetisgivenasthesurvivalfunctions(t)=1−F(t).Theeventratethataneventhasnotyethappeneduptotimetbuthappensattimetisthendeﬁnedbyahazardfunctionh(t).Therelationshipamongh(t),f(t)ands(t)ish(t)=f(t)s(t).(1)Furthermore,thesurvivalfunctions(t)canbederivedusinghazardfunctionh(t):s(t)=exp(cid:18)−Zt0h(x)dx(cid:19).(2)4ProposedModelThissectionexplainstheformulationofNoDeFandthelearn-ingalgorithmforNoDeFbasedontheEMalgorithm.Supposethatweobserveasetofnquadruplets,denotedD={(xi,yi,di,ei)}ni=1.Inparticular,xi∈RMrepresentsthefeaturevectorfortheithadanduser,whereMisthelengthofthefeaturevector.yi∈{0,1}isabinaryvariableindicatingwhethertheithsampleisconverted.di∈[0,∞]isthedelaybetweentheclickandtheconversionfortheithsample.Ifthereisnoconversion,di=∞.ei∈[0,∞)isthetimeelapsedsincetheclick.Table1summarizesthenotationofvariablesusedforNoDeF.hazard function ℎ(𝑑;𝒙,𝑽)ℎ(𝑑;𝒙,𝑽)𝛼*(𝒙;𝑽)𝑘(𝑡*,𝑑)𝑡-𝑡.𝑡/𝑡0𝑡1𝑡2time 𝑑Figure2:Relationshipamongthehazardfunctionh,intensityfunc-tionαlandkernelkinNoDeF.Theyellowdottedlineindicatesαl(x;V)ateachtimetlwhilethepalebluelineindicatestheker-nelfunctionvaluek(tl,d)ateachtimetl.Thedarkbluelineisthehazardfunctionh(d;x,V).4.1ModelNoDeFisconstructedfromtwoprobabilisticmodels.Theﬁrstmodel,whichwerefertoasthetimedelaymodel,isusedtorepresentthetimedelaysbetweentheclickandconversion.Thesecondmodel,whichwerefertoastheconversionmodel,isaclassiﬁerthatpredictswhetheranewlycominguserisconvertedforanewlydisplayedad.NoDeFisajointmodelofthesetwomodels.InNoDeF,wedeﬁnethetimedelaymodelaccordingtotheframeworkofsurvivalanalysisasdescribedinSection3.Thedistributionofthetimedelayvariesaccordingtothecon-tentsoftheaddisplayedandthecharacteristicsoftheuserswhowatchthead.Thus,inNoDeF,wedeﬁnethetimede-laymodelwithoutassuminganydistribution,suchasanex-ponentialorWeibulldistribution,suchthattheshapeofthedistributioncanbedeterminedbythecontentsoftheadandthecharacteristicsoftheusers.WeﬁrstexplainthehazardfunctionforNoDeF.Todeﬁnethehazardfunction,NoDeFplacesL∈N+equallyspacedpseudo-points{tl≥0}Ll=1onthetimeaxis.Thehazardfunc-tion(i.e.,theratethattheconversionfortheithsamplehasnotyethappeneduptotimedibuthappensattimedi)isthendeﬁnedash(di;xi,V)=LXl=1αl(xi;V)k(tl,di),(3)wherekisakernelfunctionreturningapositivevalue.In-tuitively,thevalueofthekernelfunctionrepresentsthesim-ilaritybetweentwopointsonthetimeaxis.Here,onecanusekernelfunctionsasksuchthatk(tl,τ),Ra0k(tl,τ)dτandR∞ak(tl,τ)dτfortl,τ,a≥0canbecalculatedanalytically.Forexample,aGaussiankernelwithbandwidthparameterh>0canbeusedforNoDeF.Inthiscase,theabovethreevaluesareobtainedask(tl,τ)=exp(cid:18)−(tl−τ)22h2(cid:19),(4)Za0k(tl,τ)dτ=−hrπ2(cid:20)erf(cid:18)tl−a√2h(cid:19)−erf(cid:18)tl√2h(cid:19)(cid:21),(5)Z∞ak(tl,τ)dτ=hrπ2(cid:20)1+erf(cid:18)tl−a√2h(cid:19)(cid:21).(6)αlisanintensityfunctionwithweightsV∈RL×M,whichcontrolsakernelvalueforthelthpseudo-pointtlonthetimeaxis,deﬁnedbyαl(xi;V)=(cid:16)1+exp(cid:16)−V>lxi(cid:17)(cid:17)−1.(7)Figure2illustratestherelationshipamongthehazardfunc-tionh,intensityfunctionαlandkernelkin(3).Theformulationofthehazardfunction(3)borrowstheideasofKDE.However,thetwodifferontwopoints.First,thehazardfunctioncontrolsthemagnitudeofthedensitybytheintensityfunctionαlthathasafeaturevectorxiasin-put,whileKDErepresentsthemagnitudeofthedensitybythenumberofdatapoints.Second,thehazardfunctioncom-putesthekernelvaluesofaninputtimepointdiandonlyLpseudo-points{tl}Ll=1tocalculatethedensity,whileKDEneedstocomputethekernelvaluesoftheinputtimepointandalltheobservedtimepointswhosesizeisgenerallylargerthanL.Thehazardfunctioncanthusbecomputedquicklyforanewlycomingfeaturevector.Accordingtothedeﬁnitionofthesurvivalfunction(2)and(3),thesurvivalfunctionforNoDeFiss(di;xi,V)=exp −Zdi0h(τ;xi,V)dτ!(8)=exp −LXl=1αl(xi;V)Zdi0k(tl,τ)dτ!.Asin[Chapelle,2014],weconsiderforeachsampleahid-denvariableci∈{0,1},whichindicateswhethertheithsampleisconvertedregardlessofthetimeelapseduntiltheconversion.Ifyi=1(i.e.,theithsamplehasbeencon-verted),thenci=1obviously.Meanwhile,ifyi=0(i.e.,theithsamplehasnotbeenconvertedbeforetheelapsedtimeei),thencicannotbedetermined.Thus,forsamplessuchthatyi=0,weneedtoestimatetheassignmentofciduringlearning.Wethendeﬁnetheprobabilitythattheconversionhap-penedattimedifortheithsample.Accordingtothehazardfunction(3)andthesurvivalfunction(8),theprobabilitythattheconversionhappenedattimedifortheithsamplecanbecalculatedaccordingtop(di|xi,ci=1)=s(di;xi,V)h(di;xi,V).(9)Notethatthisprobability(9)isundeﬁnedinthecaseofthesampleforwhichci=0.Withtheconversionmodel,onecanuseanybinaryclassi-ﬁerwhoselikelihoodisdifferentiable,suchaslogisticregres-sionandneuralnetworkclassiﬁers.Inthispaper,wesimplyuselogisticregressiondeﬁnedasp(ci=1|xi;w)=(cid:0)1+exp(−w>xi)(cid:1)−1,(10)p(ci=0|xi;w)=1−p(ci=1|xi),(11)wherew∈RMisaweightvectorfortheconversionclassi-ﬁer.WethendeﬁnethelikelihoodforNoDeF.Forthesakeofconvenience,wedeﬁnetwosetsofsampleindices:I1={i|yi=1,i=1,2,···,n},(12)I0={i|yi=0,i=1,2,···,n}.(13)WerespectivelyrefertoI1andI0asthepositivesamplesetandnegativesampleset.GivenparametersΘ={V,w},thelikelihoodofobserva-tionD={(xi,yi,di,ei)}ni=1canbefactorizedasp(D;Θ)=nYi=1Xci∈{0,1}p(yi|xi,ci,ei)p(ci|xi)p(di|xi,ci=1).(14)Notethatifci=0,yi=0mustbetrue.Theequationsp(yi=0|xi,ci=0,ei)=1,(15)p(yi=1|xi,ci=0,ei)=0(16)arethussatisﬁedconsistently.Therefore,byplugging(15)and(16)intolikelihood(14)anddividingthesampleindicesintotwosetsI1andI0,thelikelihoodcanbedeformedasp(D;Θ)=Yi∈I1p(ci=1|xi)p(di|yi=1,xi)(17)×Yi∈I0Xci∈{0,1}p(yi=0|xi,ci,ei)p(ci|xi).p(yi=0|xi,ci=1,ei)istheprobabilitythattheconversionhasnothappenedbeforeelapsedtimeeifortheithsampleandthattheconversionwillhappenafterward.Thisprobabil-itycanbecalculatedasp(yi=0|xi,ci=1,ei)(18)=p(di>ei|xi,ci=1,ei)(19)=1−Zei0p(di=τ|ci=1,xi)dτ(20)=s(ei;xi,V),(21)wherethetransformationfrom(20)to(21)isperformedbyapplyingthefactthats(t)=1−F(t)describedinSection3.4.2LearningAlgorithmThissectionexplainsthelearningalgorithmforNoDeFde-rivedonthebasisoftheEMalgorithm.WeﬁrstdeﬁnetheobjectivefunctioninastandardwayfortheEMalgorithm.AccordingtoJensen’sinequality,alowerboundQ(Θ;¯Θ)forthelogarithmoflikelihood(14)canbederivedaslogp(D;Θ)≥Q(Θ;¯Θ)(22)=Xi∈I1loghp(ci=1|xi)p(di|xi,ci=1)i+Xi∈I0Xci∈{0,1}¯qiciloghp(yi|xi,ci,ei)p(ci|xi)i,where¯qiciisaposteriorofcideﬁnedas¯qic=p(ci=c|xi,yi=0,ei)(23)∝p(yi=0|xi,ci=c,ei)p(ci=c|xi).Ifc=0,p(yi=0|xi,ci=c,ei)musthavethevalue1obviously.Thus,¯qi0=p(ci=0|xi,yi=0,di,ei)∝p(ci=0|xi),(24)whichcanbecalculatedusing(11).Meanwhile,ifc=1,theposteriorofcicanbecalculatedaccordingto¯qi1=p(ci=1|xi,yi=0,di,ei)∝p(ci=1|xi)p(yi=0|xi,ci=1,ei),(25)wherep(ci=1|xi)andp(yi=0|xi,ci=1,ei)arere-spectivelycalculatedusing(10)and(18).Notethat¯qicob-tainedusing(24)and(25)needstobenormalizedby¯qic=¯qic/(¯qi0+¯qi1).TheE-stepistoupdatetheposteriorofciunderthecurrentestimatesofparametersΘ.IntheM-step,weupdatetheparametersΘemployingagradient-basedoptimizationmethodsuchasthegradientde-scentmethodorquasi-Newtonmethod,ﬁxingtheposteriorofci.Inthispaper,weuseL-BFGS[LiuandNocedal,1989],anefﬁcientimplementationofthequasi-Newtonmethod,whichneedstheﬁrst-ordergradientsoftheobjectivefunction(22)withrespecttotheparametersΘ.Wehereadd‘2regulariz-ersforwandVto(22),whicharerespectivelycontrolledbystrengthparametersλw,λV≥0.TheseregularizersareidenticaltoputGaussianpriorswithzeromeanandprecisionλwandλVforthem.First,thegradientwithrespecttowiscalculatedas∂Q(Θ;¯Θ)∂w=Xi∈I1∂∂wlogp(ci=1|xi)(26)+Xi∈I0Xci∈{0,1}¯qic∂∂wlogp(ci|xi)−λww,where,∂∂wlogp(ci=1|xi)=x(1−p(ci=1|xi)),(27)∂∂wlogp(ci=0|xi)=−xp(ci=1|xi).(28)Second,thegradientwithrespecttoVliscalculatedas∂Q(Θ;¯Θ)∂Vl=Xi∈I1∂∂Vllogp(di|xi,ci=1)(29)+Xi∈I0Xci∈{0,1}¯qic∂∂Vllogp(yi=0|xi,ci,ei)−λVVl,where,∂∂Vllogp(di|xi,ci=1)=∂∂Vllogs(di;xi,V)+∂∂Vllogh(di;xi,V),(30)∂∂Vllogp(yi=0|xi,ci=1,ei)=∂∂Vllogs(ei;xi,V),(31)∂∂Vllogs(di;xi,V)=−xiαl(x;V)(1−αl(x;V))Zdi0k(tl,τ)dτ,(32)∂∂Vllogh(di;xi,V)=xiαl(x;V)(1−αl(x;V))k(tl,di)h(di;xi,V).(33)WeiterativelyestimatetheparametersΘbyalternatingE-andM-stepsuntilconvergingtheobjectivefunction(22).Insummary,thelearningalgorithmforNoDeFisshowninAl-gorithm1.Here,lbfgsupdatewandlbfgsupdateVarefunctionsthatreturnwandVupdatedusingL-BFGS,andtheargumentsaretheinitialvaluesoftheparametersandthegradientsoftheparameters.Algorithm1ParameterestimationofNoDeFbyEM-algorithmInput:trainingsetD,kernelfunctionk,maximumiterationsN∈N+,tolerance>0.//Parameterinitializationw(0)∼N(0,1),V(0)∼N(0,1),Θ(0)={w(0),V(0)}//Parameterestimationforj=1,2,···,Ndo//E-stepcomputationfori∈I0doforc∈{0,1}do¯qic=p(ci=c|xi,yi=0,ei)//using(24)endforendfor//M-stepcomputationw(j)=lbfgsupdatew(w(j−1),∂∂wQ(Θ;Θ(j−1)))V(j)=lbfgsupdateV(V(j−1),∂∂VQ(Θ;Θ(j−1)))Θ(j)={w(j),V(j)}//CheckingstopconditionifQ(Θ(j);Θ(j−1))−Q(Θ(j−1);Θ(j−2))<thenbreakendifendforOutput:Θ(j)Selectionofhyperparameters.NoDeFhasfourhyperpa-rameters:thenumberofpseudo-pointsL,bandwidthforGaussiankernelh,precisionparametersλwandλV.Thehyperparameterscanbedeterminedbycross-validationorbyusingavalidationset.Asanothermethodofdeterminingh,onecanusethelengthbetweentwoneighboringpseudo-pointsti+1,tibecausethepseudo-pointsareplacedatequalintervalsasshowninFigure2.Werecommendusingh=(ti+1−ti)/2toestimateasmoothdistributionforthetimedelay.ThismethodisconsistentlyusedintheexperimentsdescribedinSection5.4.3PredictionAftertheparametersareestimated,NoDeFcanperformtwotypesofprediction.Theﬁrstistopredictwhetheranewlycomingsamplewillbeconverted,regardlessoftheelapsedtimeofdelayedfeedback.Inthiscase,theCVRcanbeob-tainedbysimplyapplyingconversionclassiﬁer(10)forthesample.Thesecondtypeofpredictionistopredictwhetherthenewlycomingsamplewillbeconvertedupuntilthetimecho-sen.Inthiscase,theprobabilitythatthesamplexwillbeconvertedupuntilobservationtimeperiodE≥0canbecal-culatedasp(y=1|x,c=1,E)=p(c=1|x)p(d<E|c=1,x)=p(c=1|x)ZE0p(t|c=1,x)dt=p(c=1|x)(1−s(E;x,V)).(34)Notethattheﬁrstpredictioncorrespondsto(34)whenE=∞becauseR∞0p(t|c=1,x)dt=1.0.00.20.40.60.81.0Normalized time delay0.00.20.40.60.81.0DensityNoDeFExp (MLE)True dist.(a)alldata0.00.20.40.60.81.0Normalized time delay0.00.20.40.60.81.0DensityNoDeFExp (MLE)True dist(c)pattern20.00.20.40.60.81.0Normalized time delay0.00.20.40.60.81.0DensityNoDeFExp (MLE)True dist(b)pattern10.00.20.40.60.81.0Normalized time delay0.00.20.40.60.81.0DensityNoDeFExp (MLE)True dist(d)pattern3Figure3:Estimationresultsoftheprobabilitydensityfunctiononthesyntheticdataset.ThebluesolidlineindicatesNoDeFwithL=40,λw=0.01,λV=0.01,thereddashedlineindicatesanexponentialdistributionﬁttedbyMLE,andthegreenhistogramindicatesthetruedistribution.Thevalueofdensityforeachmethodisnormalizedsuchthatthemaximumvalueis1.5ExperimentsThissectionpresentstheresultsofexperimentsonsyntheticandrealdatasets.5.1ExperimentsonSyntheticDatasetThissubsectionshowshowthecorrectNoDeFcanestimatethecomplicatedshapeofadistributionofthetimedelayonasyntheticdataset.Datasetgeneration.Thesyntheticdatasetisgeneratedfromamixtureofthreedifferentdistributionssothatthesin-gledatasetincludesthreetypesofconversionbehaviorpat-terns.Fortheﬁrstpattern,thenumberofsamplesis100,a10-dimensionalfeaturevectorx∈R10foreachsampleisgeneratedfromanormaldistributionN(−3,1),anddelaytimed≥0foreachsampleisgeneratedfromatruncatednormaldistributionTN(1,1)thattruncatesvalueslessthan0andgreaterthan10.Forthesecondpattern,thenumberofsamplesis70,thefeaturevectorforeachsampleisgener-atedfromanormaldistributionN(0,1),andthedelaytimeforeachsampleisgeneratedfromatruncatednormaldistri-butionTN(4,1).Forthethirdpattern,thenumberofsam-plesis30,thefeaturevectorforeachsampleisgeneratedfromanormaldistributionN(3,1),andthedelaytimeforeachsampleisgeneratedfromatruncatednormaldistribu-tionTN(7,1).Forallsamples,theelapsedtimeeissetto10andlabely∈{0,1}isdeterminedrandomlyfromanuniformdistribution.Results.Figure3showstheestimateddensitycorrespond-ingto(9)onthesyntheticdataset.Forcomparison,wedis-playtheexponentialdistributionﬁttedbymaximumlikeli-hoodestimation(MLE),whichisusedin[Chapelle,2014]Table2:TheaveragepredictiveperformanceforallthecampaignsontheCriteodataset.Theboldfaceindicatesthebestvaluesineachofthemetrics.LoglossAccuracyAUCNAIVE0.3571±0.0060.8714±0.0030.7349±0.007DFM0.3450±0.0080.8702±0.0040.7423±0.009NoDeF0.3438±0.0080.8725±0.0030.7387±0.009Table3:Theaveragepredictiveperformancefortherecentcam-paignsontheCriteodataset.ThenotationisthesameasTable2.LoglossAccuracyAUCNAIVE0.2818±0.0210.9124±0.0130.7187±0.019DFM0.3689±0.0510.9151±0.0120.7213±0.022NoDeF0.2575±0.0200.9157±0.0120.7242±0.025formodelingthetimedelay.AsshowninFigure3(a),NoDeFcancorrectlyreconstructthreepeaksofthetruedistribution.Panels(b)–(d)thenshowtheestimateddensitywhenfeaturevectorsforeachofthethreepatternsaregiven.Asshownintheﬁgures,NoDeFcancorrectlyestimatethedensityassoci-atedwitheachpatternusingtheinputtedfeaturevectors.5.2ExperimentsontheCriteoDatasetThissubsectionpresentstheeffectivenessofNoDeFintermsofthepredictiveperformanceontheCriteodataset,whichisapopularconversionlogdatasetusedin[Chapelle,2014].Datasetpreparation.Aswith[Chapelle,2014],weusetwotypesoftheCriteodataset.Theﬁrstoneincludesthecon-versionlogsassociatedwithallthecampaigns,whilethesec-ondoneincludesthoseassociatedwiththerecentcampaigns.Foreachofthetwodataset,weﬁrstextractsixperiods.Foreachperiod,wedividethesamplesintheperiodintotraining,validationandtestsets.Thetrainingsetcomprises50,000sampleswhoseclickdateiswithintheﬁrstthreedays.Here,theconversiondateisreplacedwith‘unobserved’whentheconversiondateofthesamplesexceedstheﬁrstthreedays.Thevalidationsetcomprises10,000sampleswhoseclickdateisbetweentheﬁnaldayofthetrainingsetandthenextday.Thetestsetcomprises10,000sampleswhoseclickdateisbetweentheﬁnaldayofthevalidationsetandthenextday.Forthevalidationandtestsets,thesampleswhoseconversiondateexceedstheﬁnaldayoftheirsetsaretreatedasnegativesamples.Foreachsample,thereareeightfeaturestakingintegerval-uesandninecategoricalfeatures.Werepresenteachofthecategoricalfeaturesasaone-hotvectorandthenconcatenatetheintegerfeaturesandtheirone-hotvectors.Thedimension-alityoftheresultingfeaturevectoris2,594.Wethenreducethedimensionalityofthefeaturevectorsto100byconductingprincipalcomponentanalysis.SettingofNoDeF.ForNoDeF,weusethenormalizedlogvaluesofthedelayandelapsedtimesofeachsample.ThehyperparametersofNoDeF,L∈{10,20,30},λw∈{1.0,0.1,0.01}andλV∈{1.0,0.1,0.01}areoptimizedus-ingthevalidationsetofthedataset.hisdeterminedbythemethoddescribedinthelastparagraphofSection4.2.Settingofcomparingmethods.Forcomparison,weusetwomethodsthatarereferredtoasDFMandNAIVE.These0.00.20.40.60.81.0Normalized log time delay0.00.20.40.60.81.0Normalized densityNoDeFRaw data(a)L=100.00.20.40.60.81.0Normalized log time delay0.00.20.40.60.81.0Normalized densityNoDeFRaw data(b)L=20Figure4:TheestimateddensitiesforthetimedelayinNoDeFwithdifferentL.Theotherhyperparametersaresettoλw=0.1,λV=0.1.hisautomaticallydeterminedasdescribedinSection4.2.methodswereusedby[Chapelle,2014].DFMistheirpro-posedmethodthatconsidersthedelayedfeedbackusinganexponentialdistributionforthetimedelay.NAIVEisabase-linemethodthatusesalogisticregressionmodel1andtreatssamplesforwhichtheconversionisunobservedasnegativesamples.ThehyperparametersinDFMandNAIVEarede-terminedusingthevalidationsetofthedataset.ForDFM,wenormalizethedelaytimeandelapsetimeofeachsamplebytheobservedmaximumdelaytimeinthetrainingset.Results.Tables2and3showthepredictiveperformanceonthetwotypesoftheCriteodatasets.TheresultsindicatethatNoDeFoutperformsNAIVEandDFMintermsoflogloss,accuracyandAUC,exceptfortheAUCvalueforallthecampaignsontheCriteodataset.Then,Figure4showstheestimateddensitiesforthetimedelayinNoDeFwithdiffer-entL.TheﬁguresshowsthatNoDeFcouldcapturethetwopeaksappearingintherawdatawithoutthepriorknowledgeofthedistributionoftherawdata.Then,sincethedensitiesaresmoothfordifferentL,thisindicatesthattheautomateddeterminationofhforNoDeFiseffective.6ConclusionWeproposedanonparametricdelayedfeedbackmodel(NoDeF)forthepredictionoftheconversionrateindis-playedadvertising.Unlikeexistingdelayedfeedbackmod-els,NoDeFcanestimatethedistributionforthetimedelaybetweenanadclickandconversionnonparametrically.Bydoingso,NoDeFrepresentscomplicateddistributionsforthetimedelaythatcannotbecapturedbyparametricdistribu-tions,suchasexponentialandWeibulldistributions.Inex-periments,weshowedthatNoDeFbetterﬁttedacomplicateddistributiononasyntheticdatasetthantheexistingmodelthatassumesanexponentialdistributionforthetimedelay,andoutperformedothermodelsintermsofthepredictiveperfor-manceontheCriteodataset.Infuturework,toupdatetheparametersofNoDeFassoonaspossibleusingthelatestconversionlogs,wewillattempttodevelopanefﬁcientlearningalgorithmbasedonthestochas-ticEMalgorithm[Nielsen,2000]forNoDeF.Inaddition,wewilldemonstratetheeffectivenessoftheideaofNoDeFbyapplyingthemodeltothemulti-touchattributionsetting.1WeusedtheimplementationoflogisticregressioninScikit-learn0.19.0.http://scikit-learn.org/.References[Chapelle,2014]OlivierChapelle.ModelingDelayedFeed-backinDisplayAdvertising.Proceedingsofthe20thACMSIGKDDInternationalConferenceonKnowledgeDiscov-eryandDataMining,pages1097–1105,2014.[Chappelleetal.,2014]OliverChappelle,ErenManavoglu,andRomerRosales.SimpleandScalableResponsePre-dictionforDisplayAdvertising.ACMTransactionsonIn-telligentSystemsandTechnology,5(4):Article61,2014.[Dempsteretal.,1977]ArthurPDempster,NanMLaird,andDonaldBRubin.MaximumLikelihoodfromIncom-pleteDataviatheEMAlgorithm.JournaloftheRoyalStatisticalSociety.SeriesB(Methodological),1977.[Duetal.,2012]NanDu,LeSong,MingYuan,andAlexJSmola.LearningNetworksofHeterogeneousInﬂuence.AdvancesinNeuralInformationProcessingSystems25,pages2780–2788,2012.[JiandWang,2017]WendiJiandXiaolingWang.Addi-tionalMulti-TouchAttributionforOnlineAdvertising.Proceedingsofthe31thConferenceonArtiﬁcialIntelli-gence,pages1360–1366,2017.[Jietal.,2016]Ji,WWang,XZhang,andDell.AProba-bilisticMulti-TouchAttributionModelforOnlineAdver-tising.InInternationalConferenceonInformationandKnowledgeManagement.AssociationforComputingMa-chinery,2016.[Jietal.,2017]WendiJi,XiaolingWang,andFeidaZhu.Time-AwareConversionPrediction.FrontiersofCom-puterScience,11(4):702–716,2017.[KleinbaumandKlein,2012]DavidG.KleinbaumandMitchelKlein.SurvivalAnalysis.StatisticsforBiologyandHealth.SpringerNewYork,NewYork,NY,2012.[Leeetal.,2012]Kuang-chihLee,BurkayOrten,AliDas-dan,andWentongLi.EstimatingConversionRateinDis-playAdvertisingfromPastErformanceData.InProceed-ingsofthe18thACMSIGKDDInternationalConferenceonKnowledgeDiscoveryandDataMiningg,page768,NewYork,NewYork,USA,2012.ACMPress.[LiuandNocedal,1989]DongC.LiuandJorgeNocedal.OntheLimitedMemoryBFGSMethodforLargeScaleOptimization.MathematicalProgramming,45(1-3):503–528,aug1989.[Nielsen,2000]SørenFeodorNielsen.TheStochasticEMAlgorithm:EstimationandAsymptoticResults.Bernoulli,6(3):457,jun2000.[Rodriguezetal.,2013]ManuelGomezRodriguez,JureLeskovec,andBernhardSchoelkopf.ModelingInforma-tionPropagationwithSurvivalTheory.InProceedingsofThe30thInternationalConferenceonMachineLearning,2013.[Rosalesetal.,2012]R´omerRosales,HaibinCheng,andErenManavoglu.Post-ClickConversionModelingandAnalysisforNon-GuaranteedDeliveryDisplayAdvertis-ing.InProceedingsoftheFifthACMInternationalCon-ferenceonWebSearchandDataMining,page293,NewYork,NewYork,USA,2012.ACMPress.[Safarietal.,2017]AbdollahSafari,RachelMacKayAlt-man,andThomasM.Loughin.DisplayAdvertising:Esti-matingConversionProbabilityEfﬁciently.arXivpreprint,oct2017.[Yuetal.,2017]LinyunYu,PengCui,ChaomingSong,TianyangZhang,andShiqiangYang.ATemporallyHet-erogeneousSurvivalFrameworkwithApplicationtoSo-cialBehaviorDynamics.InProceedingsofthe23rdACMSIGKDDInternationalConferenceonKnowledgeDiscov-eryandDataMining,pages1295–1304,2017.[Zhangetal.,2015]YaZhang,YiWei,andJianbiaoRen.Multi-touchAttributioninOnlineAdvertisingwithSur-vivalTheory.InIEEEInternationalConferenceonDataMining,numberJanuary,pages687–696,2015.
